---
title: "explore_vcf_F1_F2"
author: "Nurit Eliash"
date: "1/24/2022"
output:
  html_document:
    code_folding: hide
    theme: cerulean
    toc: yes
    toc_depth: 5
    toc_float:
      collapsed: yes
      df_print: paged
---
<style type="text/css">
  body{
  font-size: 12pt;
}
</style>


## What is the mode of inheritance from F1 to F2

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### load libraries
```{r}
library("tidyverse")
library("dplyr")
library("ggplot2")
library("ggpubr")
library("scales")
library("ggpubr")
library("gridExtra")
library("grid")
library("GGally")
library("vcfR")
library("data.table")
library("stringr")
library("janitor")
library("gmodels")
library("plyr")
library("rstatix")
library("freqtables")
```

### Load vcf file 
five families with at least one grandson and two granddaughters: 
240, 284, 502, 498, 476
in total 40 individuals
```{r}
vcf <- read.vcfR("/Users/nuriteliash/Documents/GitHub/varroa-linkage-map/data/vcf_filter/five_fam.Q40BIALLDP16HDP40mis.5Chr7/five_fam.Q40BIALLDP16HDP40mis.5Chr7.recode.vcf", verbose = FALSE )
vcf

# extract the genotype for each site in each individual
gt <- extract.gt(vcf, element = "GT") 

gt <- as.data.frame(t(gt)) %>%
  rownames_to_column("sample")
```

loop the following code, over all 5 families
```{r}
plot <- list

#variables:
family <- c(unique(str_extract(gt$sample , "[^_]+")))
Gtp <- c("0/0", "0/1", "1/1")
cross <- c(homoRef_)
```


# Family 240
create data for one family
```{r}
gt_240 <- gt %>%
   dplyr::filter(grepl("240", sample)) %>%
  t() %>%
as.data.frame() %>%
row_to_names(row_number = 1)

# change the sample name to a general name:
colnames(gt_240)[grepl('fnd',colnames(gt_240))] <- 'F0_fem'
colnames(gt_240)[grepl('_son_',colnames(gt_240))] <- 'F1_male'
colnames(gt_240)[grepl('_grnson',colnames(gt_240))] <- 'F2_male'
colnames(gt_240)[grepl('_dat',colnames(gt_240))] <- 'F1_fem_1'
colnames(gt_240)[grepl('_sis',colnames(gt_240))] <- 'F1_fem_2'
colnames(gt_240)[grepl('a_grndat',colnames(gt_240))] <- 'F2_fem_1'
colnames(gt_240)[grepl('b_grndat',colnames(gt_240))] <- 'F2_fem_2'
colnames(gt_240)[grepl('c_grn',colnames(gt_240))] <- 'F2_2'
colnames(gt_240)[grepl('d_grn',colnames(gt_240))] <- 'F2_3'
colnames(gt_240)[grepl('e_grn',colnames(gt_240))] <- 'F2_4'

```

## Family 240, F1 male homozygot (1/1; 0/0), female hetero (0/1)
```{r}
# make a table with the CI for each row. 
cross_0.0_0.1 <- gt_240 %>% 
  filter(F1_male == "0/0" & F1_fem_1 == "0/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  add_row(name = c(unique(cross_0.0_0.1$name)), value = "1/1", freq = 0) %>% # add value '0' for genotype "1/1"
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  drop_na("value")

cross_1.1_0.1 <- gt_240 %>% 
  filter(F1_male == "1/1" & F1_fem_1 == "0/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  add_row(name = c(unique(cross_1.1_0.1$name)), value = "0/0", freq = 0) %>% # add value '0' for genotype "1/1"
mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  drop_na("value")

p_0.0_0.1 <- ggplot(cross_0.0_0.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/0) x female (0/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

p_1.1_0.1 <- ggplot(cross_1.1_0.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (1/1) x female (0/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

grid.arrange(p_0.0_0.1, p_1.1_0.1, ncol = 2, top = textGrob("family 240, male homozygot",gp=gpar(fontsize=20,font=3)))
```

## Family 240, F1 male homozygot and female homozygot
```{r}
cross_0.0_1.1 <- gt_240 %>% 
  filter(F1_male == "0/0" & F1_fem_1 == "1/1") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  add_row(name = c("F2_3", "F2_4", "F2_fem_1"), value = "0/1", freq = 0) %>% # add value '0' for genotype "0/1"
  add_row(name = c("F2_4", "F2_fem_2"), value = "0/0", freq = 0) %>% # add value '0' for genotype "0/1"
  add_row(name = c("F2_3", "F2_fem_2"), value = "1/1", freq = 0) %>% # add value '0' for genotype "1/1"
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  drop_na("value")

p_0.0_1.1 <- ggplot(cross_0.0_1.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/0) x female (1/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

cross_0.0_0.0 <- gt_240 %>% 
  filter(F1_male == "0/0" & F1_fem_1 == "0/0") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  add_row(name = c("F2_2", "F2_fem_1", "F2_male"), value = "1/1", freq = 0) %>% # add value '0' for genotype "1/1"
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  drop_na("value")

p_0.0_0.0 <-ggplot(cross_0.0_0.0, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/0) x female (0/0)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

cross_1.1_1.1 <- gt_240 %>% 
  filter(F1_male == "1/1" & F1_fem_1 == "1/1") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  add_row(name = c("F2_fem_1", "F2_fem_2"), value = "0/0", freq = 0) %>% # add value '0' for genotype "0/0"
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  drop_na("value")

p_1.1_1.1 <-ggplot(cross_1.1_1.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (1/1) x female (1/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

cross_1.1_0.0 <- gt_240 %>% 
  filter(F1_male == "1/1" & F1_fem_1 == "0/0") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  add_row(name = c("F2_fem_1", "F2_fem_2", "F2_3", "F2_4"), value = "0/0", freq = 0) %>% # add value '0' for genotype "0/0"
  add_row(name = c("F2_fem_1", "F2_fem_2", "F2_3", "F2_4"), value = "0/1", freq = 0) %>%
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  drop_na("value")

p_1.1_0.0 <-ggplot(cross_1.1_0.0, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (1/1) x female (0/0)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")
grid.arrange(p_0.0_0.0, p_1.1_1.1, p_1.1_0.0, p_0.0_1.1, ncol = 2, nrow=2,top = textGrob("family 240, F1 male homozygot, female homozygot",gp=gpar(fontsize=20,font=3)))
```

## Family 240, F1 male heterozygot (0/1)
```{r}
cross_0.1_0.0 <- gt_240 %>% 
  filter(F1_male == "0/1" & F1_fem_1 == "0/0") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  add_row(name = c("F2_fem_2", "F2_male"), value = "1/1", freq = 0) %>% # add value '0' for genotype "1/1"
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  drop_na("value")

cross_0.1_1.1 <- gt_240 %>% 
  filter(F1_male == "0/1" & F1_fem_1 == "1/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  add_row(name = c("F2_2", "F2_fem_1", "F2_male"), value = "0/0", freq = 0) %>% # add value '0' for genotype "1/1"
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  drop_na("value")

cross_0.1_0.1 <- gt_240 %>% 
  filter(F1_male == "0/1" & F1_fem_1 == "0/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  na.omit()

p_0.1_0.0 <- ggplot(cross_0.1_0.0, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/1) x female (0/0")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

p_0.1_1.1 <- ggplot(cross_0.1_1.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/1) x female (1/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

p_0.1_0.1 <- ggplot(cross_0.1_0.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/1) x female (0/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")
grid.arrange(p_0.1_0.0, p_0.1_1.1, p_0.1_0.1, ncol = 3, top = textGrob("family 240, male heterozygot",gp=gpar(fontsize=20,font=3)))
```


# Family 284
create data for one family
```{r}
gt_284 <- gt %>%
   dplyr::filter(grepl("284", sample)) %>%
  t() %>%
as.data.frame() %>%
row_to_names(row_number = 1)

# change the sample name to a general name:
colnames(gt_284)[grepl('fnd',colnames(gt_284))] <- 'F0_fem'
colnames(gt_284)[grepl('_son_',colnames(gt_284))] <- 'F1_male'
colnames(gt_284)[grepl('_grnson',colnames(gt_284))] <- 'F2_male'
colnames(gt_284)[grepl('_dat',colnames(gt_284))] <- 'F1_fem_1'
colnames(gt_284)[grepl('_sis',colnames(gt_284))] <- 'F1_fem_2'
colnames(gt_284)[grepl('_grndat',colnames(gt_284))] <- 'F2_fem_1'
colnames(gt_284)[grepl('c_grn',colnames(gt_284))] <- 'F2_2'
```

## Family 284, F1 male homozygot (1/1; 0/0), female hetero (0/1)
```{r}
# make a table with the CI for each row. 
cross_0.0_0.1 <- gt_284 %>% 
  filter(F1_male == "0/0" & F1_fem_1 == "0/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  na.omit()

cross_1.1_0.1 <- gt_284 %>% 
  filter(F1_male == "1/1" & F1_fem_1 == "0/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  na.omit()

p_0.0_0.1 <- ggplot(cross_0.0_0.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/0) x female (0/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

p_1.1_0.1 <- ggplot(cross_1.1_0.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (1/1) x female (0/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

grid.arrange(p_0.0_0.1, p_1.1_0.1, ncol = 2, top = textGrob("family 284, male homozygot",gp=gpar(fontsize=20,font=3)))
```

## Family 284, F1 male homozygot and female homozygot
```{r}
cross_0.0_1.1 <- gt_284 %>% 
  filter(F1_male == "0/0" & F1_fem_1 == "1/1") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  na.omit()

p_0.0_1.1 <- ggplot(cross_0.0_1.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/0) x female (1/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

cross_0.0_0.0 <- gt_284 %>% 
  filter(F1_male == "0/0" & F1_fem_1 == "0/0") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  add_row(name = c("F2_2", "F2_fem_1", "F2_male"), value = "1/1", freq = 0) %>% # add value '0' for genotype "1/1"
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  drop_na("value")

p_0.0_0.0 <-ggplot(cross_0.0_0.0, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/0) x female (0/0)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

cross_1.1_1.1 <- gt_284 %>% 
  filter(F1_male == "1/1" & F1_fem_1 == "1/1") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  na.omit()
p_1.1_1.1 <-ggplot(cross_1.1_1.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (1/1) x female (1/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

cross_1.1_0.0 <- gt_284 %>% 
  filter(F1_male == "1/1" & F1_fem_1 == "0/0") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  na.omit()
p_1.1_0.0 <-ggplot(cross_1.1_0.0, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (1/1) x female (0/0)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")
grid.arrange(p_0.0_0.0, p_1.1_1.1, p_1.1_0.0, p_0.0_1.1, ncol = 2, nrow=2,top = textGrob("family 284, F1 male homozygot, female homozygot",gp=gpar(fontsize=20,font=3)))
```

## Family 284, F1 male heterozygot (0/1)
```{r}
cross_0.1_0.0 <- gt_284 %>% 
  filter(F1_male == "0/1" & F1_fem_1 == "0/0") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  na.omit()

cross_0.1_1.1 <- gt_284 %>% 
  filter(F1_male == "0/1" & F1_fem_1 == "1/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  add_row(name = c("F2_2", "F2_fem_1", "F2_male"), value = "0/0", freq = 0) %>% # add value '0' for genotype "1/1"
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  drop_na("value")

cross_0.1_0.1 <- gt_284 %>% 
  filter(F1_male == "0/1" & F1_fem_1 == "0/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  na.omit()

p_0.1_0.0 <- ggplot(cross_0.1_0.0, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/1) x female (0/0")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

p_0.1_1.1 <- ggplot(cross_0.1_1.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/1) x female (1/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

p_0.1_0.1 <- ggplot(cross_0.1_0.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/1) x female (0/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")
grid.arrange(p_0.1_0.0, p_0.1_1.1, p_0.1_0.1, ncol = 3, top = textGrob("family 284, male heterozygot",gp=gpar(fontsize=20,font=3)))
```

# Family 502
create data for one family
```{r}
gt_502 <- gt %>%
   dplyr::filter(grepl("502", sample)) %>%
  t() %>%
as.data.frame() %>%
row_to_names(row_number = 1)

# change the sample name to a general name:
colnames(gt_502)[grepl('fnd',colnames(gt_502))] <- 'F0_fem'
colnames(gt_502)[grepl('_son_',colnames(gt_502))] <- 'F1_male'
colnames(gt_502)[grepl('_grnson',colnames(gt_502))] <- 'F2_male'
colnames(gt_502)[grepl('_dat',colnames(gt_502))] <- 'F1_fem_1'
colnames(gt_502)[grepl('_sis',colnames(gt_502))] <- 'F1_fem_2'
colnames(gt_502)[grepl('a_grndat',colnames(gt_502))] <- 'F2_fem_1'
colnames(gt_502)[grepl('f_grndat',colnames(gt_502))] <- 'F2_fem_2'
colnames(gt_502)[grepl('c_grn_',colnames(gt_502))] <- 'F2_3'
colnames(gt_502)[grepl('e_grn_',colnames(gt_502))] <- 'F2_4'
colnames(gt_502)[grepl('d_grn_',colnames(gt_502))] <- 'F2_5'

```

## Family 502, F1 male homozygot (1/1; 0/0), female hetero (0/1)
```{r}
# make a table with the CI for each row. 
cross_0.0_0.1 <- gt_502 %>% 
  filter(F1_male == "0/0" & F1_fem_1 == "0/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  na.omit()

cross_1.1_0.1 <- gt_502 %>% 
  filter(F1_male == "1/1" & F1_fem_1 == "0/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  na.omit()

p_0.0_0.1 <- ggplot(cross_0.0_0.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/0) x female (0/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

p_1.1_0.1 <- ggplot(cross_1.1_0.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (1/1) x female (0/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

grid.arrange(p_0.0_0.1, p_1.1_0.1, ncol = 2, top = textGrob("family 502, male homozygot",gp=gpar(fontsize=20,font=3)))
```

## Family 502, F1 male homozygot and female homozygot
```{r}
cross_0.0_1.1 <- gt_502 %>% 
  filter(F1_male == "0/0" & F1_fem_1 == "1/1") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  na.omit()

p_0.0_1.1 <- ggplot(cross_0.0_1.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/0) x female (1/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

cross_0.0_0.0 <- gt_502 %>% 
  filter(F1_male == "0/0" & F1_fem_1 == "0/0") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  add_row(name = c("F2_2", "F2_fem_1", "F2_male"), value = "1/1", freq = 0) %>% # add value '0' for genotype "1/1"
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  drop_na("value")

p_0.0_0.0 <-ggplot(cross_0.0_0.0, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/0) x female (0/0)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

cross_1.1_1.1 <- gt_502 %>% 
  filter(F1_male == "1/1" & F1_fem_1 == "1/1") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  na.omit()
p_1.1_1.1 <-ggplot(cross_1.1_1.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (1/1) x female (1/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

cross_1.1_0.0 <- gt_502 %>% 
  filter(F1_male == "1/1" & F1_fem_1 == "0/0") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  na.omit()
p_1.1_0.0 <-ggplot(cross_1.1_0.0, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (1/1) x female (0/0)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")
grid.arrange(p_0.0_0.0, p_1.1_1.1, p_1.1_0.0, p_0.0_1.1, ncol = 2, nrow=2,top = textGrob("family 502, F1 male homozygot, female homozygot",gp=gpar(fontsize=20,font=3)))
```

## Family 502, F1 male heterozygot (0/1)
```{r}
cross_0.1_0.0 <- gt_502 %>% 
  filter(F1_male == "0/1" & F1_fem_1 == "0/0") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  na.omit()

cross_0.1_1.1 <- gt_502 %>% 
  filter(F1_male == "0/1" & F1_fem_1 == "1/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  add_row(name = c("F2_2", "F2_fem_1", "F2_male"), value = "0/0", freq = 0) %>% # add value '0' for genotype "1/1"
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  drop_na("value")

cross_0.1_0.1 <- gt_502 %>% 
  filter(F1_male == "0/1" & F1_fem_1 == "0/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  na.omit()

p_0.1_0.0 <- ggplot(cross_0.1_0.0, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/1) x female (0/0")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

p_0.1_1.1 <- ggplot(cross_0.1_1.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/1) x female (1/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

p_0.1_0.1 <- ggplot(cross_0.1_0.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/1) x female (0/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")
grid.arrange(p_0.1_0.0, p_0.1_1.1, p_0.1_0.1, ncol = 3, top = textGrob("family 502, male heterozygot",gp=gpar(fontsize=20,font=3)))
```



# Family 498
create data for one family
```{r}
gt_498 <- gt %>%
   dplyr::filter(grepl("498", sample)) %>%
  t() %>%
as.data.frame() %>%
row_to_names(row_number = 1)

# change the sample name to a general name:
colnames(gt_498)[grepl('fnd',colnames(gt_498))] <- 'F0_fem'
colnames(gt_498)[grepl('_son_',colnames(gt_498))] <- 'F1_male'
colnames(gt_498)[grepl('_grnson',colnames(gt_498))] <- 'F2_male'
colnames(gt_498)[grepl('_dat',colnames(gt_498))] <- 'F1_fem_1'
colnames(gt_498)[grepl('_sis',colnames(gt_498))] <- 'F1_fem_2'
colnames(gt_498)[grepl('b_grndat',colnames(gt_498))] <- 'F2_fem_1'
colnames(gt_498)[grepl('c_grndat',colnames(gt_498))] <- 'F2_fem_2'
colnames(gt_498)[grepl('d_grn',colnames(gt_498))] <- 'F2_3'
colnames(gt_498)[grepl('e_grn',colnames(gt_498))] <- 'F2_4'
```

## Family 498, F1 male homozygot (1/1; 0/0), female hetero (0/1)
```{r}
# make a table with the CI for each row. 
cross_0.0_0.1 <- gt_498 %>% 
  filter(F1_male == "0/0" & F1_fem_1 == "0/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  na.omit()

cross_1.1_0.1 <- gt_498 %>% 
  filter(F1_male == "1/1" & F1_fem_1 == "0/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  na.omit()

p_0.0_0.1 <- ggplot(cross_0.0_0.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/0) x female (0/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

p_1.1_0.1 <- ggplot(cross_1.1_0.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (1/1) x female (0/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

grid.arrange(p_0.0_0.1, p_1.1_0.1, ncol = 2, top = textGrob("family 498, male homozygot",gp=gpar(fontsize=20,font=3)))
```

## Family 498, F1 male homozygot and female homozygot
```{r}
cross_0.0_1.1 <- gt_498 %>% 
  filter(F1_male == "0/0" & F1_fem_1 == "1/1") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  na.omit()

p_0.0_1.1 <- ggplot(cross_0.0_1.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/0) x female (1/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

cross_0.0_0.0 <- gt_498 %>% 
  filter(F1_male == "0/0" & F1_fem_1 == "0/0") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  add_row(name = c("F2_2", "F2_fem_1", "F2_male"), value = "1/1", freq = 0) %>% # add value '0' for genotype "1/1"
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  drop_na("value")

p_0.0_0.0 <-ggplot(cross_0.0_0.0, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/0) x female (0/0)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

cross_1.1_1.1 <- gt_498 %>% 
  filter(F1_male == "1/1" & F1_fem_1 == "1/1") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  na.omit()
p_1.1_1.1 <-ggplot(cross_1.1_1.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (1/1) x female (1/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

cross_1.1_0.0 <- gt_498 %>% 
  filter(F1_male == "1/1" & F1_fem_1 == "0/0") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  na.omit()
p_1.1_0.0 <-ggplot(cross_1.1_0.0, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (1/1) x female (0/0)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")
grid.arrange(p_0.0_0.0, p_1.1_1.1, p_1.1_0.0, p_0.0_1.1, ncol = 2, nrow=2,top = textGrob("family 498, F1 male homozygot, female homozygot",gp=gpar(fontsize=20,font=3)))
```

## Family 498, F1 male heterozygot (0/1)
```{r}
cross_0.1_0.0 <- gt_498 %>% 
  filter(F1_male == "0/1" & F1_fem_1 == "0/0") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  na.omit()

cross_0.1_1.1 <- gt_498 %>% 
  filter(F1_male == "0/1" & F1_fem_1 == "1/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  add_row(name = c("F2_2", "F2_fem_1", "F2_male"), value = "0/0", freq = 0) %>% # add value '0' for genotype "1/1"
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  drop_na("value")

cross_0.1_0.1 <- gt_498 %>% 
  filter(F1_male == "0/1" & F1_fem_1 == "0/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  na.omit()

p_0.1_0.0 <- ggplot(cross_0.1_0.0, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/1) x female (0/0")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

p_0.1_1.1 <- ggplot(cross_0.1_1.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/1) x female (1/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

p_0.1_0.1 <- ggplot(cross_0.1_0.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/1) x female (0/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")
grid.arrange(p_0.1_0.0, p_0.1_1.1, p_0.1_0.1, ncol = 3, top = textGrob("family 498, male heterozygot",gp=gpar(fontsize=20,font=3)))
```



# Family 476
create data for one family
```{r}
gt_476 <- gt %>%
   dplyr::filter(grepl("476", sample)) %>%
  t() %>%
as.data.frame() %>%
row_to_names(row_number = 1)

# change the sample name to a general name:
colnames(gt_476)[grepl('fnd',colnames(gt_476))] <- 'F0_fem'
colnames(gt_476)[grepl('_son_',colnames(gt_476))] <- 'F1_male'
colnames(gt_476)[grepl('_grnson',colnames(gt_476))] <- 'F2_male'
colnames(gt_476)[grepl('_dat',colnames(gt_476))] <- 'F1_fem_1'
colnames(gt_476)[grepl('_sis',colnames(gt_476))] <- 'F1_fem_2'
colnames(gt_476)[grepl('a_grndat',colnames(gt_476))] <- 'F2_fem_1'
colnames(gt_476)[grepl('c_grndat',colnames(gt_476))] <- 'F2_fem_2'
colnames(gt_476)[grepl('d_grndat',colnames(gt_476))] <- 'F2_fem_3'
colnames(gt_476)[grepl('e_grn',colnames(gt_476))] <- 'F2_4'

```

## Family 476, F1 male homozygot (1/1; 0/0), female hetero (0/1)
```{r}
# make a table with the CI for each row. 
cross_0.0_0.1 <- gt_476 %>% 
  filter(F1_male == "0/0" & F1_fem_1 == "0/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  na.omit()

cross_1.1_0.1 <- gt_476 %>% 
  filter(F1_male == "1/1" & F1_fem_1 == "0/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  na.omit()

p_0.0_0.1 <- ggplot(cross_0.0_0.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/0) x female (0/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

p_1.1_0.1 <- ggplot(cross_1.1_0.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (1/1) x female (0/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

grid.arrange(p_0.0_0.1, p_1.1_0.1, ncol = 2, top = textGrob("family 476, male homozygot",gp=gpar(fontsize=20,font=3)))
```

## Family 476, F1 male homozygot and female homozygot
```{r}
cross_0.0_1.1 <- gt_476 %>% 
  filter(F1_male == "0/0" & F1_fem_1 == "1/1") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  na.omit()

p_0.0_1.1 <- ggplot(cross_0.0_1.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/0) x female (1/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

cross_0.0_0.0 <- gt_476 %>% 
  filter(F1_male == "0/0" & F1_fem_1 == "0/0") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  add_row(name = c("F2_2", "F2_fem_1", "F2_male"), value = "1/1", freq = 0) %>% # add value '0' for genotype "1/1"
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  drop_na("value")

p_0.0_0.0 <-ggplot(cross_0.0_0.0, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/0) x female (0/0)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

cross_1.1_1.1 <- gt_476 %>% 
  filter(F1_male == "1/1" & F1_fem_1 == "1/1") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  na.omit()
p_1.1_1.1 <-ggplot(cross_1.1_1.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (1/1) x female (1/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

cross_1.1_0.0 <- gt_476 %>% 
  filter(F1_male == "1/1" & F1_fem_1 == "0/0") %>% 
  select(contains("F2")) %>%
  pivot_longer(everything()) %>% 
  count() %>% 
  mutate(freq = as.numeric(freq)) %>% 
  group_by(name) %>% 
  mutate(total = as.numeric(sum(freq))) %>% 
  mutate(prop = freq/total) %>% 
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>%  
  mutate(lower = prop - (se*1.96)) %>%  
  mutate(upper = prop + (se*1.96)) %>% 
  na.omit()
p_1.1_0.0 <-ggplot(cross_1.1_0.0, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (1/1) x female (0/0)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")
grid.arrange(p_0.0_0.0, p_1.1_1.1, p_1.1_0.0, p_0.0_1.1, ncol = 2, nrow=2,top = textGrob("family 476, F1 male homozygot, female homozygot",gp=gpar(fontsize=20,font=3)))
```

## Family 476, F1 male heterozygot (0/1)
```{r}
cross_0.1_0.0 <- gt_476 %>% 
  filter(F1_male == "0/1" & F1_fem_1 == "0/0") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  na.omit()

cross_0.1_1.1 <- gt_476 %>% 
  filter(F1_male == "0/1" & F1_fem_1 == "1/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  add_row(name = c("F2_2", "F2_fem_1", "F2_male"), value = "0/0", freq = 0) %>% # add value '0' for genotype "1/1"
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  drop_na("value")

cross_0.1_0.1 <- gt_476 %>% 
  filter(F1_male == "0/1" & F1_fem_1 == "0/1") %>% 
  select(contains("F2")) %>% 
  pivot_longer(everything()) %>%
  count() %>%
  mutate(freq = as.numeric(freq)) %>%
  group_by(name) %>%
  mutate(total = as.numeric(sum(freq))) %>%
  mutate(prop = freq/total) %>%
  mutate(se = (sqrt(prop * (1-prop)/freq))) %>% 
  mutate(lower = prop - (se*1.96)) %>% 
  mutate(upper = prop + (se*1.96)) %>%
  na.omit()

p_0.1_0.0 <- ggplot(cross_0.1_0.0, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/1) x female (0/0")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

p_0.1_1.1 <- ggplot(cross_0.1_1.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/1) x female (1/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")

p_0.1_0.1 <- ggplot(cross_0.1_0.1, aes(y=prop, x=name, color=value)) + 
    geom_point(size = 4) +
    geom_errorbar(aes(ymin=lower, ymax=upper)) +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F1 male (0/1) x female (0/1)")  +
    geom_text(aes(label = freq),  hjust = 0, nudge_x = 0.15, color = "black")
grid.arrange(p_0.1_0.0, p_0.1_1.1, p_0.1_0.1, ncol = 3, top = textGrob("family 476, male heterozygot",gp=gpar(fontsize=20,font=3)))
```











# unused codes:
```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
#agneesh
  x1 <- gt_284 %>% filter(F1_male == "0/1" & F1_fem_1 == "0/1") %>% select(F2_male,F2_3,F2_fem_1)  %>% pivot_longer(everything()) %>% count()
  
  # Family 284 -- bar
gt_284 <- gt %>%
   dplyr::filter(grepl("284", sample)) %>%
  t() %>%
as.data.frame() %>%
row_to_names(row_number = 1)

# change the sample name to a general name:
colnames(gt_284)[grepl('fnd',colnames(gt_284))] <- 'F0_fem'
colnames(gt_284)[grepl('_son_',colnames(gt_284))] <- 'F1_male'
colnames(gt_284)[grepl('_grnson',colnames(gt_284))] <- 'F2_male'
colnames(gt_284)[grepl('_dat',colnames(gt_284))] <- 'F1_fem_1'
colnames(gt_284)[grepl('_sis',colnames(gt_284))] <- 'F1_fem_2'
colnames(gt_284)[grepl('_grndat',colnames(gt_284))] <- 'F2_fem_1'
#colnames(gt_284)[grepl('b_grndat',colnames(gt_284))] <- 'F2_fem_2'
colnames(gt_284)[grepl('c_grn',colnames(gt_284))] <- 'F2_3'
colnames(gt_284)[grepl('e_grn',colnames(gt_284))] <- 'F2_4'

x <- gt_284 %>% filter(F1_male == "0/1" & F1_fem_1 == "0/1") %>% select(F2_male,F2_3,F2_fem_1)  %>% pivot_longer(everything()) %>% count()

p_x<- ggplot(x %>% drop_na(),aes(x = as.factor(name),y = freq)) +
  geom_col(aes(fill = value))


y <- gt_284 %>% filter(F1_male == "0/0" & F1_fem_1 == "0/1") %>% select(F2_male,F2_3,F2_fem_1)  %>% pivot_longer(everything()) %>% count()

p_y <- ggplot(y %>% drop_na(),aes(x = as.factor(name),y = freq)) +
  geom_col(aes(fill = value))


a <- gt_284 %>% filter(F1_male == "1/1" & F1_fem_1 == "0/1") %>% select(F2_male,F2_3,F2_fem_1)  %>% pivot_longer(everything()) %>% count()

p_a <- ggplot(a %>% drop_na(),aes(x = as.factor(name),y = freq)) +
  geom_col(aes(fill = value))

grid.arrange(p_x, p_y, p_a, top = textGrob("family 284",gp=gpar(fontsize=20,font=3)))

################### former plot:
#plot it
p_son_0.0_dat_0.1 <- ggplot(count_F2, aes(fill=Gt, y=n, x=F2)) + 
    geom_bar(position="fill", stat="identity") +
    xlab("F2 siblings") + 
    ylab("Proportion of F2 genotype") +
    labs(title = "F2 genotype of F1 cross: son (0/0) x daughter (0/1), 
family 476") + 
   geom_text(aes(label = n), position = position_fill(vjust = 0.2, reverse= F))

# add additional info for each individual
gt <- gt %>%
  mutate(fam = str_extract(sample, "[^_]+")) %>%
  mutate(sex = case_when(
    grepl("son", sample) ~ "male",
    grepl("dat|fnd|sis", sample) ~ "female",
    grepl( "_grn_",sample) ~ "ND")) %>%
  mutate(generation = case_when(
    grepl("fnd", sample) ~ "F0",
    grepl("_dat_|sis|_son_", sample) ~ "F1",
    grepl("grn", sample) ~ "F2")) %>%
  mutate(fam_membership = case_when(
    grepl("fnd", sample) ~ "Foundress_mother",
    grepl("_dat_", sample) ~ "Daughter",
    grepl("sis", sample) ~ "Second_daughter",
    grepl("_son_", sample) ~ "Son",
    grepl("grnson", sample) ~ "Grandson",
    grepl("_grndat_", sample) ~ "Granddaughter",
    grepl("_grn_", sample) ~ "Grandson_daughter")) %>%
  dplyr::select(sample, fam, sex, generation, fam_membership, everything())
```
